{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Huawe\\u0131\\\\VS_CODE\\\\film-dizi-oneri-sitesi-main\\\\film-dizi-oneri-sitesi-main\\\\Frontend\\\\src\\\\components\\\\ChooseFilms.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChooseFilms = () => {\n  _s();\n  const [films, setFilms] = useState([]);\n  const [selected, setSelected] = useState([]);\n  const navigate = useNavigate();\n  useEffect(() => {\n    fetch(`${process.env.REACT_APP_API_URL}/films`).then(res => res.json()).then(data => setFilms(data)).catch(err => console.error(\"Film çekme hatası:\", err));\n  }, []);\n  const toggleSelect = film => {\n    if (selected.find(f => f._id === film._id)) {\n      setSelected(selected.filter(f => f._id !== film._id));\n    } else {\n      if (selected.length < 3) {\n        setSelected([...selected, film]);\n      } else {\n        alert(\"Sadece 3 film seçebilirsiniz.\");\n      }\n    }\n  };\n  const calculateAverages = () => {\n    const keys = [\"romance\", \"action\", \"adventure\", \"horror\", \"thriller\", \"sciFi\", \"imdb\"];\n    const avg = {};\n    keys.forEach(key => {\n      const total = selected.reduce((sum, film) => sum + (film[key] || 0), 0);\n      avg[key] = parseFloat((total / selected.length).toFixed(2));\n    });\n    return avg;\n  };\n\n  //HADNLESUBMİT\n  const handleSubmit = async () => {\n    if (selected.length !== 3) {\n      alert(\"Lütfen 3 film seçin.\");\n      return;\n    }\n    console.log(\"🎬 Gönderilecek favoriler:\", selected);\n    const preference = calculateAverages();\n    const token = localStorage.getItem(\"token\");\n\n    // ⬇️ Film ID ve puanı içeren sade dizi\n    const ratings = selected.map(film => ({\n      movieId: film._id,\n      score: 10 // ⭐ dilersen burada kullanıcıya özel puanlama sorusu da açabilirsin\n    }));\n    try {\n      const userRes = await fetch(`${process.env.REACT_APP_API_URL}/me`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const user = await userRes.json();\n      console.log(\"👤 Kullanıcı ID:\", user._id);\n\n      // ✅ Favori gönderimi (ratings olarak gönderiyoruz!)\n      const favRes = await fetch(`${process.env.REACT_APP_API_URL}/users/${user._id}/favorites`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          ratings\n        }) // ✅ ratings ismiyle ve doğru formatta\n      });\n      const favResult = await favRes.json();\n      console.log(\"✅ Favori gönderildi:\", favResult);\n\n      // ✅ Tercih gönderimi\n      const prefRes = await fetch(`${process.env.REACT_APP_API_URL}/users/${user._id}/preferences`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          preference\n        })\n      });\n      const prefResult = await prefRes.json();\n      console.log(\"✅ Tercihler gönderildi:\", prefResult);\n      navigate(\"/home\");\n    } catch (err) {\n      console.error(\"🔥 Global HATA:\", err);\n      alert(\"Kayıt sırasında bir hata oluştu.\");\n    }\n  };\n\n  ////////////////////////////////////////7\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: \"2rem\",\n      textAlign: \"center\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uD83C\\uDFAF 3 favori filmini se\\xE7\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        justifyContent: \"center\",\n        gap: \"1rem\"\n      },\n      children: films.map(film => /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: () => toggleSelect(film),\n        style: {\n          width: \"200px\",\n          border: selected.find(f => f._id === film._id) ? \"3px solid #00ffff\" : \"1px solid #ccc\",\n          borderRadius: \"8px\",\n          padding: \"1rem\",\n          cursor: \"pointer\",\n          backgroundColor: \"#fff\",\n          boxShadow: \"0 2px 6px rgba(0,0,0,0.1)\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: film.photo,\n          alt: film.name,\n          style: {\n            width: \"100%\",\n            height: \"260px\",\n            objectFit: \"cover\",\n            borderRadius: \"6px\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n          style: {\n            marginTop: \"0.5rem\"\n          },\n          children: film.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 13\n        }, this)]\n      }, film._id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSubmit,\n      style: {\n        marginTop: \"2rem\",\n        padding: \"0.75rem 2rem\",\n        fontSize: \"1rem\",\n        cursor: \"pointer\"\n      },\n      children: \"Kaydet ve Devam Et\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n};\n_s(ChooseFilms, \"nF+fqI+kusU/en05OpMqhLNEaSw=\", false, function () {\n  return [useNavigate];\n});\n_c = ChooseFilms;\nexport default ChooseFilms;\nvar _c;\n$RefreshReg$(_c, \"ChooseFilms\");","map":{"version":3,"names":["React","useEffect","useState","useNavigate","jsxDEV","_jsxDEV","ChooseFilms","_s","films","setFilms","selected","setSelected","navigate","fetch","process","env","REACT_APP_API_URL","then","res","json","data","catch","err","console","error","toggleSelect","film","find","f","_id","filter","length","alert","calculateAverages","keys","avg","forEach","key","total","reduce","sum","parseFloat","toFixed","handleSubmit","log","preference","token","localStorage","getItem","ratings","map","movieId","score","userRes","headers","Authorization","user","favRes","method","body","JSON","stringify","favResult","prefRes","prefResult","style","padding","textAlign","children","fileName","_jsxFileName","lineNumber","columnNumber","display","flexWrap","justifyContent","gap","onClick","width","border","borderRadius","cursor","backgroundColor","boxShadow","src","photo","alt","name","height","objectFit","marginTop","fontSize","_c","$RefreshReg$"],"sources":["C:/Users/Huaweı/VS_CODE/film-dizi-oneri-sitesi-main/film-dizi-oneri-sitesi-main/Frontend/src/components/ChooseFilms.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst ChooseFilms = () => {\n  const [films, setFilms] = useState([]);\n  const [selected, setSelected] = useState([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    fetch(`${process.env.REACT_APP_API_URL}/films`)\n      .then((res) => res.json())\n      .then((data) => setFilms(data))\n      .catch((err) => console.error(\"Film çekme hatası:\", err));\n  }, []);\n\n  const toggleSelect = (film) => {\n    if (selected.find((f) => f._id === film._id)) {\n      setSelected(selected.filter((f) => f._id !== film._id));\n    } else {\n      if (selected.length < 3) {\n        setSelected([...selected, film]);\n      } else {\n        alert(\"Sadece 3 film seçebilirsiniz.\");\n      }\n    }\n  };\n\n  const calculateAverages = () => {\n    const keys = [\"romance\", \"action\", \"adventure\", \"horror\", \"thriller\", \"sciFi\", \"imdb\"];\n    const avg = {};\n    keys.forEach((key) => {\n      const total = selected.reduce((sum, film) => sum + (film[key] || 0), 0);\n      avg[key] = parseFloat((total / selected.length).toFixed(2));\n    });\n    return avg;\n  };\n\n  //HADNLESUBMİT\nconst handleSubmit = async () => {\n  if (selected.length !== 3) {\n    alert(\"Lütfen 3 film seçin.\");\n    return;\n  }\n\n  console.log(\"🎬 Gönderilecek favoriler:\", selected);\n\n  const preference = calculateAverages();\n  const token = localStorage.getItem(\"token\");\n\n  // ⬇️ Film ID ve puanı içeren sade dizi\n  const ratings = selected.map((film) => ({\n    movieId: film._id,\n    score: 10  // ⭐ dilersen burada kullanıcıya özel puanlama sorusu da açabilirsin\n  }));\n\n  try {\n    const userRes = await fetch(`${process.env.REACT_APP_API_URL}/me`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    const user = await userRes.json();\n    console.log(\"👤 Kullanıcı ID:\", user._id);\n\n    // ✅ Favori gönderimi (ratings olarak gönderiyoruz!)\n    const favRes = await fetch(`${process.env.REACT_APP_API_URL}/users/${user._id}/favorites`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify({ ratings }),  // ✅ ratings ismiyle ve doğru formatta\n    });\n\n    const favResult = await favRes.json();\n    console.log(\"✅ Favori gönderildi:\", favResult);\n\n    // ✅ Tercih gönderimi\n    const prefRes = await fetch(`${process.env.REACT_APP_API_URL}/users/${user._id}/preferences`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify({ preference }),\n    });\n\n    const prefResult = await prefRes.json();\n    console.log(\"✅ Tercihler gönderildi:\", prefResult);\n\n    navigate(\"/home\");\n  } catch (err) {\n    console.error(\"🔥 Global HATA:\", err);\n    alert(\"Kayıt sırasında bir hata oluştu.\");\n  }\n};\n\n\n  ////////////////////////////////////////7\n\n  return (\n    <div style={{ padding: \"2rem\", textAlign: \"center\" }}>\n      <h2>🎯 3 favori filmini seç</h2>\n      <div style={{ display: \"flex\", flexWrap: \"wrap\", justifyContent: \"center\", gap: \"1rem\" }}>\n        {films.map((film) => (\n          <div\n            key={film._id}\n            onClick={() => toggleSelect(film)}\n            style={{\n              width: \"200px\",\n              border: selected.find((f) => f._id === film._id) ? \"3px solid #00ffff\" : \"1px solid #ccc\",\n              borderRadius: \"8px\",\n              padding: \"1rem\",\n              cursor: \"pointer\",\n              backgroundColor: \"#fff\",\n              boxShadow: \"0 2px 6px rgba(0,0,0,0.1)\"\n            }}\n          >\n            <img\n              src={film.photo}\n              alt={film.name}\n              style={{ width: \"100%\", height: \"260px\", objectFit: \"cover\", borderRadius: \"6px\" }}\n            />\n            <h4 style={{ marginTop: \"0.5rem\" }}>{film.name}</h4>\n          </div>\n        ))}\n      </div>\n      <button\n        onClick={handleSubmit}\n        style={{ marginTop: \"2rem\", padding: \"0.75rem 2rem\", fontSize: \"1rem\", cursor: \"pointer\" }}\n      >\n        Kaydet ve Devam Et\n      </button>\n    </div>\n  );\n};\n\nexport default ChooseFilms;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}